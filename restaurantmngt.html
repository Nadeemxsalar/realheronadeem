<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real Hero Restaurant - Ultimate</title>
    <link
      rel="icon"
      id="favicon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçî</text></svg>"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* --- Basic Setup & NEW Color Variables --- */
      :root {
        /* New Dark Theme */
        --bg-color: #121828;
        --card-color: rgba(30, 41, 59, 0.6);
        --text-color: #e2e8f0;
        --text-muted: #94a3b8;
        --primary-color: #ff7e5f; /* Coral */
        --primary-hover: #feb47b; /* Lighter Coral */
        --secondary-color: #38bdf8; /* Sky Blue */
        --secondary-hover: #0ea5e9;
        --border-color: rgba(51, 65, 85, 0.5);
        --shadow-color: rgba(255, 126, 95, 0.15);
        --header-bg: rgba(30, 41, 59, 0.7);
        --success-color: #22c55e;
        --danger-color: #ef4444;
      }

      body.light-mode {
        /* New Light Theme */
        --bg-color: #f1f5f9;
        --card-color: rgba(255, 255, 255, 0.7);
        --text-color: #0f172a;
        --text-muted: #475569;
        --primary-color: #ef4444; /* Red */
        --primary-hover: #dc2626;
        --secondary-color: #2563eb; /* Blue */
        --secondary-hover: #1d4ed8;
        --border-color: rgba(203, 213, 225, 0.8);
        --shadow-color: rgba(239, 68, 68, 0.15);
        --header-bg: rgba(255, 255, 255, 0.7);
      }

      body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: var(--bg-color);
        color: var(--text-color);
        transition: background 0.5s, color 0.5s;
      }

      /* --- Animations & Keyframes --- */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* --- Header & Navigation --- */
      header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: var(--header-bg);
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border-color);
        backdrop-filter: blur(15px);
        transition: background 0.5s;
      }

      header h1 {
        color: var(--primary-color);
        font-size: 24px;
        margin: 0;
      }

      nav a {
        margin: 0 10px;
        color: var(--text-color);
        text-decoration: none;
        font-weight: 500;
        padding: 8px 15px;
        border-radius: 8px;
        transition: 0.3s;
        position: relative;
      }

      nav a:hover,
      nav a.active {
        background: var(--primary-color);
        color: white;
      }

      .hamburger {
        display: none;
        cursor: pointer;
        font-size: 28px;
      }

      /* --- General Components --- */
      button, .btn {
        padding: 10px 18px;
        border: none;
        border-radius: 10px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 5px;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .btn-secondary {
        background: var(--secondary-color);
        color: white;
      }

      .btn-secondary:hover {
        background: var(--secondary-hover);
        transform: translateY(-2px);
      }
      .btn-danger {
        background: var(--danger-color);
        color: white;
      }
      .btn-danger:hover {
        opacity: 0.8;
      }


      button:disabled {
        background: #94a3b8;
        cursor: not-allowed;
        color: #e2e8f0;
      }

      input,
      select,
      textarea {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        background: transparent;
        color: var(--text-color);
        margin-bottom: 10px;
        width: 100%; /* Changed for better responsiveness */
        box-sizing: border-box; /* Ensures padding doesn't affect final width */
        transition: all 0.3s ease;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px var(--shadow-color);
      }

      .glass-card {
        backdrop-filter: blur(12px);
        background: var(--card-color);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-color);
        text-align: center;
        position: relative;
        animation: fadeInUp 0.6s ease forwards;
        opacity: 0;
        transition: background 0.5s;
        margin: 20px;
      }

      .text-contrast {
        color: var(--text-color);
      }

      /* --- Advanced Menu Controls --- */
      .menu-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 25px;
      }

      .search-container {
        position: relative;
        flex-grow: 1;
        min-width: 250px;
      }

      .search-icon {
        position: absolute;
        top: 50%;
        left: 15px;
        transform: translateY(-50%);
        color: var(--text-muted);
        pointer-events: none;
      }

      #searchBar {
        width: 100%;
        padding-left: 45px;
        margin-bottom: 0;
      }

      #searchSuggestions {
        display: none;
        position: absolute;
        top: 110%;
        left: 0;
        right: 0;
        background: var(--card-color);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        z-index: 100;
        max-height: 200px;
        overflow-y: auto;
        backdrop-filter: blur(10px);
        text-align: left;
      }
      #searchSuggestions div {
        padding: 10px 15px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      #searchSuggestions div:hover {
        background-color: var(--primary-color);
        color: white;
      }

      .sort-filters {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .sort-filters button {
        background: transparent;
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 8px 15px;
        border-radius: 8px;
        font-size: 14px;
        margin: 0;
      }

      .sort-filters button.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }
      .sort-filters button i {
        margin-right: 5px;
      }

      /* --- Menu & Food Cards --- */
      .menu-items {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }

      .food-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        padding: 15px;
        border-radius: 15px;
        position: relative;
        background: var(--card-color);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .food-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 40px var(--shadow-color);
      }

      .food-img {
        width: 100%;
        border-radius: 10px;
        cursor: pointer;
        aspect-ratio: 16/10;
        object-fit: cover;
      }

      .card-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .card-actions button {
        flex-grow: 1;
        padding: 8px 12px;
        font-size: 14px;
      }

      .stock-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--danger-color);
        color: white;
        padding: 4px 8px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
      }

      .fav-btn {
        position: absolute;
        top: 10px;
        left: 10px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.5);
        padding: 0;
        margin: 0;
      }

      .fav-btn.favorited {
        color: #ff7e5f;
      }

      /* --- Category Filters --- */
      .category-filters {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 20px;
      }

      .category-filters button {
        background: var(--card-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
      }

      .category-filters button.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      /* --- Cart & Orders --- */
      .cart-item,
      .order-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .order-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
        background: var(--card-color);
        border-radius: 10px;
        margin-bottom: 10px;
      }

      .cart-item-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: center;
      }

      .cart-summary {
        margin-top: 20px;
        text-align: right;
      }

      .cart-summary .checkout-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }

      .coupon-section {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .coupon-section input {
        flex-grow: 1; /* Allow input to take space */
      }

      /* --- Modals (Login & Item Details) --- */
      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: var(--card-color);
        backdrop-filter: blur(15px);
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        animation: fadeInUp 0.5s;
        position: relative;
        text-align: left;
      }

      .close-btn {
        color: #aaa;
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      #itemModal-content img {
        width: 100%;
        border-radius: 10px;
        margin-bottom: 15px;
      }

      /* --- Toast Notifications --- */
      #toast-container {
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 3000;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .toast {
        padding: 15px 20px;
        border-radius: 10px;
        color: white;
        min-width: 250px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        animation: slideInRight 0.5s;
      }

      .toast.success { background: var(--success-color); }
      .toast.error { background: var(--danger-color); }
      .toast.info { background: #3b82f6; }

      /* --- Admin Panel Styles --- */
      .admin-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
      }
      .admin-tabs button {
        background: transparent;
        color: var(--text-muted);
        border: 1px solid var(--border-color);
      }
      .admin-tabs button.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }
      .admin-tab-content { display: none; }
      .admin-tab-content.active { display: block; }
      .admin-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
        text-align: center;
      }
      .admin-card {
        background: var(--bg-color);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
      }
      .admin-card h4 { margin-top: 0; color: var(--text-muted); }
      .admin-card p { font-size: 1.5em; font-weight: bold; margin-bottom: 0; }
      
      /* *** NEW: Responsive Table Container *** */
      .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
      }

      .admin-table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
        margin-top: 15px;
        min-width: 600px; /* Force scroll on smaller screens */
      }
      .admin-table th, .admin-table td {
        padding: 12px 15px;
        border-bottom: 1px solid var(--border-color);
        white-space: nowrap; /* Prevent text wrapping */
      }
      .admin-table th { color: var(--text-muted); }
      .admin-table td .btn { padding: 5px 10px; font-size: 12px; margin: 0 2px;}
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: var(--text-muted);
      }
      .coupon-add-form {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }


      /* --- Responsive --- */
      @media (max-width: 768px) {
        header { padding: 15px; }
        .menu-links {
          display: none;
          flex-direction: column;
          gap: 10px;
          position: absolute;
          top: 70px;
          right: 10px;
          background: var(--header-bg);
          padding: 20px;
          border-radius: 10px;
          width: 200px;
          text-align: center;
        }
        .menu-links.active { display: flex; }
        .hamburger { display: block; }
        .menu-controls { justify-content: center; }
        .sort-filters { justify-content: center; }
        .glass-card {
          margin: 10px 0;
          padding: 15px;
          border-radius: 0;
          box-shadow: none;
          border-left: none;
          border-right: none;
        }
        .cart-item {
          flex-direction: column;
          gap: 10px;
          align-items: flex-start;
        }
      }

      /* *** NEW: Specific Mobile Fix for Coupon Form *** */
      @media (max-width: 480px) {
        .coupon-add-form {
            flex-direction: column;
            align-items: stretch;
        }
      }

    </style>
  </head>

  <body class="dark-mode">
    <header id="header">
      <h1><i class="fas fa-utensils"></i> Real Hero Restaurant üç¥</h1>
      <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
      <nav class="menu-links" id="menuLinks">
        <a href="#" id="user-greeting" class="nav-link-item" onclick="handleUserClick()">Login</a>
        <a href="#" class="nav-link nav-link-item" onclick="showSection('menuSection')">Menu</a>
        <a href="#" class="nav-link nav-link-item" onclick="showSection('myOrdersSection')">My Orders</a>
        <a href="#" class="nav-link nav-link-item" onclick="showSection('adminSection')">Admin</a>
        <a href="#" class="nav-link nav-link-item" onclick="showSection('cartSection')">
          <i class="fas fa-shopping-cart"></i> Cart
          <span
            id="cartBadge"
            class="cart-badge"
            style="
              background: var(--primary-color); color: white; padding: 2px 6px; border-radius: 10px;
            "
            >0</span
          >
        </a>
        <span id="loyalty-points" style="margin-left: 10px; font-weight: bold; color:var(--text-color); align-self: center;"
          >üèÜ 0 pts</span
        >
        <button
          id="theme-toggle"
          onclick="toggleTheme()"
          style="
            background: none; border: none; font-size: 20px; color: var(--text-color);
          "
        >
          <i class="fas fa-sun"></i>
        </button>
      </nav>
    </header>

    <div id="toast-container"></div>

    <section id="menuSection" class="glass-card">
      <h2 class="text-contrast">Our Menu</h2>
      <div class="category-filters" id="categoryFilters"></div>

      <div class="menu-controls">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            id="searchBar"
            placeholder="Search your favorite food..."
            oninput="handleSearchInput()"
          />
          <div id="searchSuggestions"></div>
        </div>
        <div class="sort-filters" id="sortFilters">
          <button class="active" onclick="applySort('default', this)">
            Default
          </button>
          <button onclick="applySort('price-asc', this)">
            <i class="fas fa-arrow-up"></i> Price
          </button>
          <button onclick="applySort('price-desc', this)">
            <i class="fas fa-arrow-down"></i> Price
          </button>
          <button onclick="applySort('rating-desc', this)">
            <i class="fas fa-star"></i> Rating
          </button>
        </div>
      </div>

      <div class="menu-items" id="menuItems"></div>
    </section>

    <section id="cartSection" class="glass-card" style="display: none">
      <h2 class="text-contrast">Your Cart</h2>
      <div id="cartItems">Your cart is empty.</div>
      <div id="cartSummary" class="cart-summary" style="display: none">
        <p>Estimated Delivery: <strong>25-30 minutes</strong></p>
        <div class="coupon-section">
          <input type="text" id="couponCode" placeholder="Enter Coupon Code" />
          <button class="btn-secondary" onclick="applyCoupon()">Apply</button>
        </div>
        <h3 id="cartTotal">Total: ‚Çπ0</h3>
        <div class="checkout-buttons">
          <button
            class="btn-danger"
            onclick="resetCart(true)"
          >
            Clear Cart
          </button>
          <button class="btn-secondary" onclick="placeOfflineOrder()">
            Pay on Delivery
          </button>
          <button class="btn-primary" onclick="placeOrder()">
            Checkout & Pay
          </button>
        </div>
      </div>
    </section>

    <section id="myOrdersSection" class="glass-card" style="display: none">
      <h2 class="text-contrast">My Past Orders</h2>
      <div id="myOrdersContainer"></div>
    </section>

    <section id="adminSection" class="glass-card" style="display: none">
        <h2 class="text-contrast">Admin Panel</h2>
        <div id="loginBox">
            <input type="password" id="adminPass" placeholder="Enter Password" />
            <button onclick="loginAdmin()" class="btn-primary">Login</button>
        </div>
        <div id="adminDashboard" style="display: none; text-align: left;">
            <div class="admin-tabs">
                <button class="active" onclick="showAdminTab('dashboardTab', this)">Dashboard</button>
                <button onclick="showAdminTab('menuTab', this)">Menu</button>
                <button onclick="showAdminTab('ordersTab', this)">Orders</button>
                <button onclick="showAdminTab('couponsTab', this)">Coupons</button>
                <button onclick="showAdminTab('usersTab', this)">Users</button>
            </div>
    
            <div id="dashboardTab" class="admin-tab-content active">
                <h3>Dashboard Overview</h3>
                <div id="admin-analytics-grid" class="admin-grid"></div>
                <div style="width: 100%; max-width: 600px; margin: 20px auto;">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
    
            <div id="menuTab" class="admin-tab-content">
                <h3>Menu Management</h3>
                <button class="btn-primary" onclick="showAddItemForm()">+ Add New Item</button>
                <div class="table-container" id="menuManagementContainer"></div>
            </div>
    
            <div id="ordersTab" class="admin-tab-content">
                <h3>Live Order Management</h3>
                <div class="table-container" id="liveOrdersContainer"></div>
            </div>
    
            <div id="couponsTab" class="admin-tab-content">
                <h3>Coupon Management</h3>
                <div class="coupon-add-form">
                    <div class="form-group" style="flex-grow:1; margin:0;"><label>Code</label><input type="text" id="newCouponCode" placeholder="e.g. SAVE10" style="margin:0;"></div>
                    <div class="form-group" style="flex-grow:1; margin:0;"><label>Discount %</label><input type="number" id="newCouponValue" placeholder="e.g. 10" style="margin:0;"></div>
                    <button class="btn-primary" onclick="addCoupon()" style="margin:0;">Add</button>
                </div>
                <div class="table-container" id="couponManagementContainer"></div>
            </div>
    
            <div id="usersTab" class="admin-tab-content">
                <h3>User Management</h3>
                <div class="table-container" id="userManagementContainer"></div>
            </div>
    
            <button onclick="logoutAdmin()" class="btn-danger" style="margin-top: 20px;">Logout</button>
        </div>
    </section>

    <div id="loginModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal('loginModal')"
          >&times;</span
        >
        <h2>Enter Your Name</h2>
        <input type="text" id="userNameInput" placeholder="Your Name" />
        <button class="btn-primary" onclick="handleLogin()">Login</button>
      </div>
    </div>

    <div id="itemModal" class="modal">
      <div class="modal-content" id="itemModal-content">
        <span class="close-btn" onclick="closeModal('itemModal')">&times;</span>
      </div>
    </div>

    <div id="formModal" class="modal">
        <div class="modal-content" id="formModal-content">
            </div>
    </div>


    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      // --- STATE & DATA ---
      let cart = [];
      let favorites = [];
      const ADMIN_PASS = "Nadeem20";
      let COUPONS = { HERO10: 0.1, EAT20: 0.2 };
      let discount = 0;
      let salesChart; // Chart instance

      // Upgraded Menu Data
      let menuItemsData = [
        { id: 1, name: "Juicy Burger", price: 150, img: "https://images.unsplash.com/photo-1571091718767-18b5b1457add?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1172&q=80", cat: "Non-Veg", rating: 5, stock: 10, desc: "A delicious, flame-grilled burger with all the fixings.", tags: ["Best Seller üî•"] },
        { id: 2, name: "Margherita Pizza", price: 350, img: "https://safrescobaldistatic.blob.core.windows.net/media/2022/11/PIZZA-MARGHERITA.jpg", cat: "Veg", rating: 5, stock: 15, desc: "Classic pizza with fresh tomatoes, mozzarella cheese, and basil.", tags: [] },
        { id: 3, name: "Spicy Pasta", price: 250, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQtGxJQNLQ_tpfDqgGfFpEARarc7qNGTDVEYg&s.jpg", cat: "Veg", rating: 4, stock: 20, desc: "Penne pasta in a spicy arrabbiata sauce, topped with parmesan.", tags: ["Spicy üå∂Ô∏è"] },
        { id: 4, name: "Chilled Coke", price: 50, img: "https://mir-s3-cdn-cf.behance.net/project_modules/hd_webp/53cf4d12641901.56270d7c1fb09.jpg", cat: "Drinks", rating: 3, stock: 50, desc: "A refreshing, chilled bottle of Coca-Cola.", tags: [] },
        { id: 5, name: "Club Sandwich", price: 120, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQfVnVChbaixLmZEptZzMRGqkthPeSpsXb8Yg&s.jpg", cat: "Veg", rating: 4, stock: 25, desc: "A triple-layered sandwich with fresh veggies and mayonnaise.", tags: [] },
        { id: 6, name: "Golden Fries", price: 100, img: "https://www.bakingo.com/blog/wp-content/uploads/2022/06/best-choco-lava-cake-recipe-ever.jpg", cat: "Veg", rating: 5, stock: 30, desc: "Crispy, golden-brown French fries, lightly salted.", tags: [] },
        { id: 7, name: "Choco Lava Cake", price: 110, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQkD7OSbyvoEzYoqjoEAjzRxlV0QUXQ7E2M9g&s.jpg", cat: "Veg", rating: 5, stock: 18, desc: "Warm chocolate cake with a gooey, molten center.", tags: ["Dessert üç∞"] },
        { id: 8, name: "Chicken Biryani", price: 280, img: "https://images.unsplash.com/photo-1589302168068-964664d93dc0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80", cat: "Non-Veg", rating: 5, stock: 12, desc: "Aromatic basmati rice cooked with chicken and exotic spices.", tags: ["Best Seller üî•"] },
        { id: 9, name: "Paneer Tikka", price: 220, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTx4JCtjJnuFSXTEBClNiJCykZsOl_DYYmNPQ&s.jpg", cat: "Veg", rating: 4, stock: 22, desc: "Cubes of paneer marinated in spices and grilled in a tandoor.", tags: ["Spicy üå∂Ô∏è"] },
        { id: 10, name: "Veg Spring Rolls", price: 140, img: "https://www.womansworld.com/wp-content/uploads/2023/09/airfryer13.jpg?quality=86&strip=all", cat: "Veg", rating: 4, stock: 0, desc: "Crispy fried rolls stuffed with mixed vegetables.", tags: [] },
        { id: 11, name: "Oreo Milkshake", price: 160, img: "https://images.unsplash.com/photo-1572490122747-3968b75cc699?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80", cat: "Drinks", rating: 5, stock: 30, desc: "A thick and creamy milkshake made with Oreo cookies.", tags: ["Drinks ü•§"] },
        { id: 12, name: "Veg Hakka Noodles", price: 180, img: "https://www.sharmispassions.com/wp-content/uploads/2012/09/HakkaNoodles4-e1689045142580-500x500.jpg", cat: "Veg", rating: 4, stock: 25, desc: "Stir-fried noodles with a mix of fresh vegetables.", tags: [] },
      ];

      // --- INITIALIZATION ---
      document.addEventListener("DOMContentLoaded", () => {
        // Load data from localStorage or use defaults
        cart = JSON.parse(localStorage.getItem("cart")) || [];
        favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        COUPONS = JSON.parse(localStorage.getItem("coupons")) || { HERO10: 0.1, EAT20: 0.2 };
        menuItemsData = JSON.parse(localStorage.getItem("menuItems")) || menuItemsData;

        const savedTheme = localStorage.getItem("theme") || "dark";
        document.body.className = savedTheme + "-mode";
        document.getElementById("theme-toggle").innerHTML =
          savedTheme === "dark"
            ? '<i class="fas fa-sun"></i>'
            : '<i class="fas fa-moon"></i>';
        updateFavicon(savedTheme);
        updateUserDisplay();
        updateLoyaltyPointsDisplay();
        displayCategories();
        renderMenu(); // Initial render
        updateCart();
        showSection("menuSection");

        // *** NAVBAR FIX ***: Close mobile menu on link click
        document.querySelectorAll('.nav-link-item').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    document.getElementById('menuLinks').classList.remove('active');
                }
            });
        });
      });

      // --- CORE UI & THEME ---
      function showSection(id) {
        ["menuSection", "cartSection", "adminSection", "myOrdersSection"].forEach((secId) => {
          document.getElementById(secId).style.display =
            secId === id ? "block" : "none";
        });
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.classList.remove("active");
          if (link.getAttribute("onclick").includes(id)) {
            link.classList.add("active");
          }
        });
        if (id === "myOrdersSection") showMyOrders();
        if (id === 'adminSection' && document.getElementById('adminDashboard').style.display === 'block') {
             renderAdminDashboard();
        }
      }

      function toggleMenu() {
        document.getElementById("menuLinks").classList.toggle("active");
      }

      function toggleTheme() {
        const isDark = document.body.classList.toggle("dark-mode");
        document.body.classList.toggle("light-mode", !isDark);
        const theme = document.body.classList.contains("dark-mode") ? "dark" : "light";
        localStorage.setItem("theme", theme);
        document.getElementById("theme-toggle").innerHTML =
          theme === "dark"
            ? '<i class="fas fa-sun"></i>'
            : '<i class="fas fa-moon"></i>';
        updateFavicon(theme);
        if(salesChart) {
            salesChart.destroy();
            renderAdminDashboard();
        }
      }

      function updateFavicon(theme) {
        const favicon = document.getElementById("favicon");
        const newIcon =
          theme === "dark"
            ? "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçï</text></svg>"
            : "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçî</text></svg>";
        favicon.href = newIcon;
      }

      function showToast(message, type = "info") {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }
      
      function closeModal(modalId) { 
        document.getElementById(modalId).style.display = "none";
      }

      // --- MENU, SEARCH, SORT, FILTER ---
      function renderMenu() {
        const activeCategoryBtn = document.querySelector('#categoryFilters button.active');
        const category = activeCategoryBtn ? activeCategoryBtn.innerText : 'All';
        const searchTerm = document.getElementById('searchBar').value.toLowerCase();
        const activeSortBtn = document.querySelector('#sortFilters button.active');
        const sortBy = activeSortBtn ? activeSortBtn.getAttribute('onclick').match(/'([^']*)'/)[1] : 'default';

        let items = [...menuItemsData];
        if (category !== 'All') items = items.filter(i => i.cat === category);
        if (searchTerm) items = items.filter(i => i.name.toLowerCase().includes(searchTerm));
        if (sortBy === "price-asc") items.sort((a, b) => a.price - b.price);
        else if (sortBy === "price-desc") items.sort((a, b) => b.price - a.price);
        else if (sortBy === "rating-desc") items.sort((a, b) => b.rating - a.rating);

        displayMenu(items);
      }

      function displayMenu(items) {
        const container = document.getElementById("menuItems");
        container.innerHTML = items.length ? "" : "<p>No items match your criteria.</p>";
        items.forEach((item) => {
          const isOutOfStock = item.stock <= 0;
          const isFavorited = favorites.includes(item.id);
          const div = document.createElement("div");
          div.className = "food-card";
          div.innerHTML = `
            <div>
              ${ isOutOfStock ? '<div class="stock-badge">Out of Stock</div>' : "" }
              <button class="fav-btn ${isFavorited ? "favorited" : ""}" onclick="toggleFavorite(event, ${item.id})">
                <i class="fas fa-heart"></i>
              </button>
              <img src="${item.img}" class="food-img" onclick="showItemModal(${item.id})">
              <h3 class="text-contrast">${item.name}</h3>
              <p style="color:var(--text-muted);">Rating: ${"‚òÖ".repeat(item.rating)}${"‚òÜ".repeat(5 - item.rating)}</p>
              <p class="text-contrast" style="font-size:1.2em; font-weight:bold;">‚Çπ${item.price}</p>
            </div>
            <div class="card-actions">
              <button class="btn-secondary" onclick="addToCart(${item.id})" ${isOutOfStock ? "disabled" : ""}>
                <i class="fas fa-cart-plus"></i> Add
              </button>
              <button class="btn-primary" onclick="orderNow(${item.id})" ${isOutOfStock ? "disabled" : ""}>
                Order Now
              </button>
            </div>
          `;
          container.appendChild(div);
        });
      }
      
      function displayCategories() {
        const categories = ["All", ...new Set(menuItemsData.map((item) => item.cat))];
        const container = document.getElementById("categoryFilters");
        container.innerHTML = categories
          .map((cat) => `<button class="${cat === "All" ? "active" : ""}" onclick="filterByCategory(this, '${cat}')">${cat}</button>`)
          .join("");
      }

      function filterByCategory(btn, category) {
        document.querySelectorAll("#categoryFilters button").forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        renderMenu();
      }
      
      function handleSearchInput() {
        renderMenu();
        const searchTerm = document.getElementById("searchBar").value.toLowerCase();
        const suggestionsContainer = document.getElementById("searchSuggestions");
        if (searchTerm.length > 1) {
          const filtered = menuItemsData.filter((i) => i.name.toLowerCase().includes(searchTerm));
          suggestionsContainer.innerHTML = filtered
            .slice(0, 5)
            .map((s) => `<div onclick="selectSuggestion('${s.name}')">${s.name}</div>`)
            .join("");
          suggestionsContainer.style.display = filtered.length > 0 ? "block" : "none";
        } else {
          suggestionsContainer.style.display = "none";
        }
      }

      function selectSuggestion(name) {
        document.getElementById("searchBar").value = name;
        document.getElementById("searchSuggestions").style.display = "none";
        renderMenu();
      }

      function applySort(sortBy, btn) {
        document.querySelectorAll('#sortFilters button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderMenu();
      }

      function toggleFavorite(event, itemId) {
        event.stopPropagation();
        const index = favorites.indexOf(itemId);
        if (index > -1) {
          favorites.splice(index, 1);
          showToast("Removed from favorites.", "info");
        } else {
          favorites.push(itemId);
          showToast("Added to favorites!", "success");
        }
        localStorage.setItem("favorites", JSON.stringify(favorites));
        renderMenu();
      }
      
      // --- CART FUNCTIONS ---
      function addToCart(id) {
        const itemData = menuItemsData.find((i) => i.id === id);
        const existingItem = cart.find((i) => i.id === id);
        const currentQtyInCart = existingItem ? existingItem.qty : 0;
        if (itemData.stock <= currentQtyInCart) {
          showToast("Cannot add more, item is out of stock!", "error");
          return;
        }
        if (existingItem) existingItem.qty++;
        else cart.push({ ...itemData, qty: 1 });
        showToast(`${itemData.name} added to cart!`, "success");
        updateCart();
      }
      function updateCart() {
        localStorage.setItem("cart", JSON.stringify(cart));
        const cartDiv = document.getElementById("cartItems");
        const cartSummary = document.getElementById("cartSummary");
        if (cart.length === 0) {
          cartDiv.innerHTML = "<p>Your cart is empty.</p>";
          cartSummary.style.display = "none";
          document.getElementById("cartBadge").innerText = 0;
          return;
        }
        cartSummary.style.display = "block";
        cartDiv.innerHTML = cart.map((item, index) => `
          <div class="cart-item">
            <span>${item.name} (‚Çπ${item.price})</span>
            <div class="cart-item-controls">
              <button onclick="updateCartItemQty(${index}, -1)">-</button>
              <span>${item.qty}</span>
              <button onclick="updateCartItemQty(${index}, 1)">+</button>
              <button onclick="removeFromCart(${index})" style="background: var(--danger-color); color: white;"><i class="fas fa-trash"></i></button>
            </div>
            <span>‚Çπ${item.price * item.qty}</span>
          </div>
        `).join("");
        const totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
        const subtotal = cart.reduce((acc, item) => acc + item.price * item.qty, 0);
        const total = subtotal - subtotal * discount;
        document.getElementById("cartBadge").innerText = totalQty;
        document.getElementById("cartTotal").innerHTML = `
        ${discount > 0 ? `<p style="font-size:0.9em; color:var(--text-muted);">Subtotal: ‚Çπ${subtotal.toFixed(2)}</p>
        <p style="font-size:0.9em; color:var(--success-color);">Discount: -‚Çπ${(subtotal * discount).toFixed(2)}</p>` : ""}
        <h3>Total: ‚Çπ${total.toFixed(2)}</h3>
        `;
      }
      function updateCartItemQty(index, delta) {
        const itemData = menuItemsData.find((i) => i.id === cart[index].id);
        if (delta > 0 && itemData.stock <= cart[index].qty) {
          showToast("No more stock available!", "error");
          return;
        }
        cart[index].qty += delta;
        if (cart[index].qty <= 0) cart.splice(index, 1);
        updateCart();
      }
      function removeFromCart(index) {
        showToast(`${cart[index].name} removed from cart.`, "info");
        cart.splice(index, 1);
        updateCart();
      }
      function applyCoupon() {
        const code = document.getElementById("couponCode").value.toUpperCase();
        if (COUPONS[code]) {
          discount = COUPONS[code];
          showToast(`Coupon '${code}' applied!`, "success");
        } else {
          discount = 0;
          showToast("Invalid coupon code.", "error");
        }
        updateCart();
      }
      function resetCart(showNotification = false) {
        cart = [];
        discount = 0;
        updateCart();
        if (showNotification) showToast("Cart cleared!", "info");
      }

      // --- ORDER & PAYMENT ---
      function orderNow(itemId) {
        const itemData = menuItemsData.find((i) => i.id === itemId);
        if (itemData.stock <= 0) {
          showToast("Sorry, this item is out of stock.", "error");
          return;
        }
        resetCart(false);
        cart.push({ ...itemData, qty: 1 });
        updateCart();
        showToast(`Proceed to checkout for ${itemData.name}`, "info");
        showSection("cartSection");
      }
      function placeOrder() {
        if (!localStorage.getItem("userName")) {
          showToast("Please login to place an order.", "error");
          showLoginModal();
          return;
        }
        if (cart.length === 0) {
          showToast("Your cart is empty.", "error");
          return;
        }
        const subtotal = cart.reduce((acc, item) => acc + item.price * item.qty, 0);
        const total = subtotal - subtotal * discount;
        var options = {
          key: "YOUR_RAZORPAY_KEY_ID",
          amount: total * 100,
          currency: "INR",
          name: "Real Hero Restaurant",
          description: "Food & Beverage Payment",
          image: "https://i.ibb.co/b31Vjdc/burger.jpg",
          handler: function (response) {
            processSuccessfulOrder(total, "Online (Paid)");
          },
          prefill: { name: localStorage.getItem("userName") },
          theme: { color: getComputedStyle(document.documentElement).getPropertyValue("--primary-color") },
        };
        var rzp1 = new Razorpay(options);
        rzp1.on("payment.failed", (response) => showToast("Payment Failed: " + response.error.description, "error"));
        rzp1.open();
      }
      function placeOfflineOrder() {
        if (!localStorage.getItem("userName")) {
          showToast("Please login to place an order.", "error");
          showLoginModal();
          return;
        }
        if (cart.length === 0) {
          showToast("Your cart is empty.", "error");
          return;
        }
        const subtotal = cart.reduce((acc, item) => acc + item.price * item.qty, 0);
        const total = subtotal - subtotal * discount;
        processSuccessfulOrder(total, "Pay on Delivery");
      }
      function processSuccessfulOrder(total, paymentMethod) {
        cart.forEach((cartItem) => {
          const itemInMenu = menuItemsData.find((menuItem) => menuItem.id === cartItem.id);
          if (itemInMenu) itemInMenu.stock -= cartItem.qty;
        });
        localStorage.setItem("menuItems", JSON.stringify(menuItemsData));

        const name = localStorage.getItem("userName");
        const pointsEarned = Math.floor(total / 100) * 10;
        let users = JSON.parse(localStorage.getItem("users") || "{}");
        if(users[name]) users[name].loyaltyPoints += pointsEarned;
        localStorage.setItem("users", JSON.stringify(users));
        updateLoyaltyPointsDisplay();
        
        const allOrders = JSON.parse(localStorage.getItem("allOrders") || "[]");
        const newOrder = { 
            id: Date.now(), user: name, date: new Date().toLocaleString(), 
            total: total.toFixed(2), items: [...cart], status: "Preparing", paymentMethod: paymentMethod 
        };
        allOrders.push(newOrder);
        localStorage.setItem("allOrders", JSON.stringify(allOrders));
        showToast(`Order placed! You earned ${pointsEarned} points.`, "success");
        resetCart();
        renderMenu();
        showSection("myOrdersSection");
      }

      // --- USER & LOYALTY ---
      function showLoginModal() { document.getElementById("loginModal").style.display = "flex"; }
      function handleLogin() {
        const name = document.getElementById("userNameInput").value.trim();
        if (name) {
          localStorage.setItem("userName", name);
          let users = JSON.parse(localStorage.getItem("users") || "{}");
          if(!users[name]) users[name] = { loyaltyPoints: 0 };
          localStorage.setItem("users", JSON.stringify(users));
          updateUserDisplay();
          updateLoyaltyPointsDisplay();
          closeModal("loginModal");
          showToast(`Welcome, ${name}!`, "success");
        }
      }
      function logoutUser() {
        localStorage.removeItem("userName");
        updateUserDisplay();
        updateLoyaltyPointsDisplay(true); // reset points display
        showToast("You have been logged out.", "info");
      }
      function handleUserClick() {
        if (localStorage.getItem("userName")) logoutUser();
        else showLoginModal();
      }
      function updateUserDisplay() {
        const name = localStorage.getItem("userName");
        document.getElementById("user-greeting").innerText = name ? `üëã Logout, ${name}!` : "Login";
      }
      function updateLoyaltyPointsDisplay(reset = false) {
        const pointsEl = document.getElementById("loyalty-points");
        if (reset) {
            pointsEl.innerText = `üèÜ 0 pts`;
            return;
        }
        const name = localStorage.getItem("userName");
        if(name) {
            let users = JSON.parse(localStorage.getItem("users") || "{}");
            const points = users[name] ? users[name].loyaltyPoints : 0;
            pointsEl.innerText = `üèÜ ${points} pts`;
        } else {
             pointsEl.innerText = `üèÜ 0 pts`;
        }
      }

      // --- ITEM DETAILS MODAL ---
      function showItemModal(itemId) {
        const item = menuItemsData.find((i) => i.id === itemId);
        if (!item) return;
        document.getElementById("itemModal-content").innerHTML = `
        <span class="close-btn" onclick="closeModal('itemModal')">&times;</span>
        <img src="${item.img}" alt="${item.name}">
        <h2>${item.name}</h2> <p>${item.desc}</p>
        <p style="font-size:1.5em; font-weight:bold;">‚Çπ${item.price}</p>
        <button class="btn-primary" onclick="addToCart(${item.id}); closeModal('itemModal');">Add to Cart</button>`;
        document.getElementById("itemModal").style.display = "flex";
      }

      // --- MY ORDERS ---
      function showMyOrders() {
        const allOrders = JSON.parse(localStorage.getItem("allOrders") || "[]");
        const currentUser = localStorage.getItem("userName");
        const container = document.getElementById("myOrdersContainer");
        if (!currentUser) {
          container.innerHTML = "<p>Please login to see your orders.</p>";
          return;
        }
        const myOrders = allOrders.filter(o => o.user === currentUser);
        container.innerHTML = myOrders.length ? "" : "<p>No past orders found.</p>";
        myOrders.reverse().forEach((order) => {
          if (order.status === "Preparing" && Date.now() - order.id > 60000) order.status = "Out for Delivery";
          if (order.status === "Out for Delivery" && Date.now() - order.id > 120000) order.status = "Delivered";
          
          const div = document.createElement("div");
          div.className = "order-card";
          div.innerHTML = `
            <div>
              <h4>Order on ${order.date} (ID: ${order.id})</h4>
              <p>Items: ${order.items.map((i) => `${i.name} (x${i.qty})`).join(", ")}</p>
              <p>Payment: <strong>${order.paymentMethod}</strong></p>
              <p>Total: <strong>‚Çπ${order.total}</strong></p>
              <p>Status: <strong style="color:var(--primary-color);">${order.status}</strong></p>
            </div>
            <button class="btn-secondary" onclick="reOrder(${order.id})">Re-order</button>
          `;
          container.appendChild(div);
        });
      }
      function reOrder(orderId) {
        const orderToReorder = JSON.parse(localStorage.getItem("allOrders") || "[]").find((o) => o.id === orderId);
        if (orderToReorder) {
          cart = [...orderToReorder.items];
          showToast("Items from your past order have been added to the cart!", "success");
          updateCart();
          showSection("cartSection");
        }
      }
      
      // --- NEW: ADMIN PANEL FUNCTIONS ---
      function loginAdmin() {
        if (document.getElementById("adminPass").value === ADMIN_PASS) {
          document.getElementById("loginBox").style.display = "none";
          document.getElementById("adminDashboard").style.display = "block";
          showAdminTab('dashboardTab', document.querySelector('.admin-tabs button'));
        } else {
          showToast("Wrong Password", "error");
        }
      }

      function logoutAdmin() {
        document.getElementById("adminPass").value = "";
        document.getElementById("loginBox").style.display = "block";
        document.getElementById("adminDashboard").style.display = "none";
      }

      function showAdminTab(tabId, btn) {
        document.querySelectorAll('.admin-tab-content').forEach(tab => tab.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelectorAll('.admin-tabs button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        if(tabId === 'dashboardTab') renderAdminDashboard();
        if(tabId === 'menuTab') renderMenuManagement();
        if(tabId === 'ordersTab') renderOrderManagement();
        if(tabId === 'couponsTab') renderCouponManagement();
        if(tabId === 'usersTab') renderUserManagement();
      }

      function renderAdminDashboard() {
        const allOrders = JSON.parse(localStorage.getItem("allOrders") || "[]");
        const totalRevenue = allOrders.reduce((sum, order) => sum + parseFloat(order.total), 0);
        const itemCounts = allOrders.flatMap(o => o.items).reduce((acc, i) => { acc[i.name] = (acc[i.name] || 0) + i.qty; return acc; }, {});
        const mostPopular = Object.keys(itemCounts).length ? Object.entries(itemCounts).sort((a,b) => b[1] - a[1])[0][0] : "N/A";

        document.getElementById('admin-analytics-grid').innerHTML = `
            <div class="admin-card"><h4>Total Revenue</h4><p>‚Çπ${totalRevenue.toFixed(2)}</p></div>
            <div class="admin-card"><h4>Total Orders</h4><p>${allOrders.length}</p></div>
            <div class="admin-card"><h4>Most Popular</h4><p>${mostPopular}</p></div>`;
        renderSalesChart(allOrders);
      }
      
      function renderSalesChart(orders) {
          const ctx = document.getElementById('salesChart').getContext('2d');
          const categorySales = orders.flatMap(o => o.items).reduce((acc, i) => { acc[i.cat] = (acc[i.cat] || 0) + (i.price * i.qty); return acc; }, {});
          if(salesChart) salesChart.destroy();
          const isDarkMode = document.body.classList.contains('dark-mode');
          const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.1)';
          const textColor = isDarkMode ? '#e2e8f0' : '#0f172a';
          salesChart = new Chart(ctx, { type: 'bar', data: { labels: Object.keys(categorySales), datasets: [{ label: 'Sales by Category', data: Object.values(categorySales), backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'] }] }, options: { responsive: true, plugins: { legend: { labels: { color: textColor } } }, scales: { y: { beginAtZero: true, ticks: { color: textColor }, grid: { color: gridColor } }, x: { ticks: { color: textColor }, grid: { color: gridColor } } } } });
      }

      function renderMenuManagement() {
        document.getElementById('menuManagementContainer').innerHTML = `
            <table class="admin-table">
            <thead><tr><th>Name</th><th>Price</th><th>Stock</th><th>Featured</th><th>Actions</th></tr></thead>
            <tbody>${menuItemsData.map(item => `
                <tr>
                    <td>${item.name}</td><td>‚Çπ${item.price}</td><td>${item.stock}</td>
                    <td><input type="checkbox" ${item.tags.includes("Best Seller üî•") ? "checked" : ""} onchange="toggleFeatured(${item.id}, this.checked)"></td>
                    <td><button class="btn btn-secondary" onclick="showEditItemForm(${item.id})">Edit</button> <button class="btn btn-danger" onclick="deleteItem(${item.id})">Del</button></td>
                </tr>`).join('')}</tbody></table>`;
      }
      
      function showAddItemForm() {
        document.getElementById('formModal-content').innerHTML = `
            <span class="close-btn" onclick="closeModal('formModal')">&times;</span><h2>Add New Menu Item</h2>
            <div class="form-group"><label>Name</label><input type="text" id="itemName"></div>
            <div class="form-group"><label>Price</label><input type="number" id="itemPrice"></div>
            <div class="form-group"><label>Stock</label><input type="number" id="itemStock"></div>
            <div class="form-group"><label>Category</label><input type="text" id="itemCat"></div>
            <div class="form-group"><label>Image URL</label><input type="text" id="itemImg"></div>
            <div class="form-group"><label>Description</label><textarea id="itemDesc"></textarea></div>
            <button class="btn-primary" onclick="handleAddItem()">Save Item</button>`;
        document.getElementById('formModal').style.display = 'flex';
      }

      function handleAddItem() {
        menuItemsData.push({ id: Date.now(), name: document.getElementById('itemName').value, price: parseInt(document.getElementById('itemPrice').value), stock: parseInt(document.getElementById('itemStock').value), cat: document.getElementById('itemCat').value, img: document.getElementById('itemImg').value, desc: document.getElementById('itemDesc').value, rating: 5, tags: [] });
        localStorage.setItem("menuItems", JSON.stringify(menuItemsData));
        closeModal('formModal');
        showToast("Item added successfully!", "success");
        renderMenuManagement(); renderMenu(); displayCategories();
      }
      
      function showEditItemForm(itemId) {
        const item = menuItemsData.find(i => i.id === itemId);
        document.getElementById('formModal-content').innerHTML = `
            <span class="close-btn" onclick="closeModal('formModal')">&times;</span><h2>Edit ${item.name}</h2>
            <div class="form-group"><label>Name</label><input type="text" id="itemName" value="${item.name}"></div>
            <div class="form-group"><label>Price</label><input type="number" id="itemPrice" value="${item.price}"></div>
            <div class="form-group"><label>Stock</label><input type="number" id="itemStock" value="${item.stock}"></div>
            <div class="form-group"><label>Category</label><input type="text" id="itemCat" value="${item.cat}"></div>
            <div class="form-group"><label>Image URL</label><input type="text" id="itemImg" value="${item.img}"></div>
            <div class="form-group"><label>Description</label><textarea id="itemDesc">${item.desc}</textarea></div>
            <button class="btn-primary" onclick="handleEditItem(${itemId})">Update Item</button>`;
        document.getElementById('formModal').style.display = 'flex';
      }
      
      function handleEditItem(itemId) {
        const item = menuItemsData.find(i => i.id === itemId);
        Object.assign(item, { name: document.getElementById('itemName').value, price: parseInt(document.getElementById('itemPrice').value), stock: parseInt(document.getElementById('itemStock').value), cat: document.getElementById('itemCat').value, img: document.getElementById('itemImg').value, desc: document.getElementById('itemDesc').value });
        localStorage.setItem("menuItems", JSON.stringify(menuItemsData));
        closeModal('formModal');
        showToast("Item updated successfully!", "success");
        renderMenuManagement(); renderMenu();
      }

      function deleteItem(itemId) {
        if(confirm("Are you sure you want to delete this item?")) {
            menuItemsData = menuItemsData.filter(i => i.id !== itemId);
            localStorage.setItem("menuItems", JSON.stringify(menuItemsData));
            showToast("Item deleted!", "info");
            renderMenuManagement(); renderMenu();
        }
      }

      function toggleFeatured(itemId, isChecked) {
        const item = menuItemsData.find(i => i.id === itemId);
        const tag = "Best Seller üî•";
        const tagIndex = item.tags.indexOf(tag);
        if(isChecked && tagIndex === -1) item.tags.push(tag);
        else if (!isChecked && tagIndex > -1) item.tags.splice(tagIndex, 1);
        localStorage.setItem("menuItems", JSON.stringify(menuItemsData));
        showToast(`${item.name} featured status updated.`, "info");
      }

      function renderOrderManagement() {
        const allOrders = JSON.parse(localStorage.getItem("allOrders") || "[]");
        document.getElementById('liveOrdersContainer').innerHTML = `<table class="admin-table">
            <thead><tr><th>Order ID</th><th>User</th><th>Total</th><th>Items</th><th>Status</th></tr></thead>
            <tbody>${allOrders.reverse().map(order => `
                <tr>
                    <td>${order.id}</td><td>${order.user}</td><td>‚Çπ${order.total}</td>
                    <td>${order.items.map(i => i.name).join(', ')}</td>
                    <td><select onchange="updateOrderStatus(${order.id}, this.value)">
                        <option value="Preparing" ${order.status === "Preparing" ? "selected" : ""}>Preparing</option>
                        <option value="Out for Delivery" ${order.status === "Out for Delivery" ? "selected" : ""}>Out for Delivery</option>
                        <option value="Delivered" ${order.status === "Delivered" ? "selected" : ""}>Delivered</option>
                        <option value="Cancelled" ${order.status === "Cancelled" ? "selected" : ""}>Cancelled</option>
                    </select></td>
                </tr>`).join('')}</tbody></table>`;
      }
      
      function updateOrderStatus(orderId, newStatus) {
        let allOrders = JSON.parse(localStorage.getItem("allOrders") || "[]");
        const order = allOrders.find(o => o.id === orderId);
        if(order) {
            order.status = newStatus;
            localStorage.setItem("allOrders", JSON.stringify(allOrders));
            showToast(`Order ${orderId} status updated to ${newStatus}`, "info");
        }
      }
      
      function renderCouponManagement() {
        document.getElementById('couponManagementContainer').innerHTML = `<table class="admin-table">
            <thead><tr><th>Code</th><th>Discount</th><th>Action</th></tr></thead>
            <tbody>${Object.entries(COUPONS).map(([code, value]) => `
                <tr><td>${code}</td><td>${value * 100}%</td>
                <td><button class="btn btn-danger" onclick="deleteCoupon('${code}')">Delete</button></td>
                </tr>`).join('')}</tbody></table>`;
      }

      function addCoupon() {
        const code = document.getElementById('newCouponCode').value.toUpperCase();
        const value = parseFloat(document.getElementById('newCouponValue').value);
        if(code && value > 0 && value <= 100) {
            COUPONS[code] = value / 100;
            localStorage.setItem("coupons", JSON.stringify(COUPONS));
            showToast(`Coupon ${code} added!`, "success");
            document.getElementById('newCouponCode').value = '';
            document.getElementById('newCouponValue').value = '';
            renderCouponManagement();
        } else showToast("Invalid code or discount value.", "error");
      }

      function deleteCoupon(code) {
        if(confirm(`Are you sure you want to delete coupon ${code}?`)) {
            delete COUPONS[code];
            localStorage.setItem("coupons", JSON.stringify(COUPONS));
            showToast(`Coupon ${code} deleted.`, "info");
            renderCouponManagement();
        }
      }
      
      function renderUserManagement() {
        const users = JSON.parse(localStorage.getItem("users") || "{}");
        const allOrders = JSON.parse(localStorage.getItem("allOrders") || "[]");
        document.getElementById('userManagementContainer').innerHTML = `<table class="admin-table">
            <thead><tr><th>Username</th><th>Loyalty Points</th><th>Total Orders</th></tr></thead>
            <tbody>${Object.entries(users).map(([name, data]) => `
                <tr><td>${name}</td><td>${data.loyaltyPoints}</td><td>${allOrders.filter(o => o.user === name).length}</td></tr>`).join('')}
            </tbody></table>`;
      }

    </script>
  </body>
</html>
